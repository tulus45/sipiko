<!DOCTYPE html>
<html lang="id" oncontextmenu="return false">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiPiko - Sistem Piket Kelas Otomatis</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- STYLE DASAR --- */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --card-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; 
        }

        textarea, input { -webkit-user-select: text; -moz-user-select: text; -ms-user-select: text; user-select: text; }

        #inputPage {
            max-width: 800px;
            margin: 30px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }

        /* --- FANCY HEADER --- */
        .logo-container { text-align: center; margin-bottom: 30px; animation: float 3s ease-in-out infinite; }
        h1.logo-text {
            font-family: 'Poppins', sans-serif; font-size: 3.5rem; margin: 0; font-weight: 900; letter-spacing: -2px;
            background: linear-gradient(to right, #3498db, #9b59b6, #e74c3c, #3498db); background-size: 300% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 5s linear infinite;
        }
        .app-desc {
            display: inline-block; background: #e3f2fd; color: #1565c0; padding: 6px 20px; border-radius: 50px;
            font-weight: 600; font-size: 14px; letter-spacing: 0.5px; margin-top: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #bbdefb;
        }
        @keyframes shine { to { background-position: 200% center; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        p.subtitle { text-align: center; color: #95a5a6; margin-bottom: 30px; font-size: 14px; }

        .teacher-note {
            background: #fff3e0; border-left: 5px solid #ff9800; padding: 20px; border-radius: 8px;
            margin-bottom: 30px; display: flex; gap: 15px; align-items: start; font-size: 14px; line-height: 1.5; color: #5d4037;
        }
        .teacher-note h3 { margin: 0 0 5px 0; color: #e65100; font-size: 16px; font-weight: 700; }

        .input-group { display: flex; gap: 20px; margin-bottom: 20px; align-items: stretch; }
        .input-box { flex: 1; display: flex; flex-direction: column; }
        label { font-weight: 600; font-size: 14px; display: block; margin-bottom: 8px; }
        .male label { color: #2980b9; } .female label { color: #c0392b; }

        textarea {
            width: 100%; height: 200px; padding: 15px; border: 2px solid #bdc3c7; border-radius: 10px;
            font-family: inherit; font-size: 14px; resize: none; transition: 0.3s; box-sizing: border-box;
        }
        textarea:focus { border-color: var(--accent); outline: none; }

        /* OPTIONS & CALENDAR */
        .options-wrapper {
            background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; 
            border: 1px dashed #ccc; display: flex; flex-direction: column; gap: 15px; align-items: center;
        }

        .checkbox-group {
            display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
        }
        .checkbox-label {
            display: flex; align-items: center; gap: 8px; font-weight: 600; cursor: pointer; font-size: 14px;
        }

        .calendar-wrapper {
            display: none; margin-top: 15px; background: white; border: 1px solid #ddd; border-radius: 8px; padding: 10px;
            max-width: 350px; width: 100%; margin-left: auto; margin-right: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; color: var(--primary); }
        .cal-btn { cursor: pointer; padding: 5px 10px; background: #eee; border-radius: 5px; user-select: none; }
        .cal-btn:hover { background: #ddd; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 13px; }
        .cal-day-name { font-weight: bold; color: #7f8c8d; font-size: 12px; margin-bottom: 5px; }
        .cal-day { padding: 8px; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .cal-day:hover { background-color: #ecf0f1; }
        .cal-day.selected { background-color: var(--accent); color: white; font-weight: bold; }
        .cal-day.empty { cursor: default; pointer-events: none; }
        .cal-day-name:nth-child(1) { color: var(--accent); font-weight: 900; } 

        button.btn-main {
            width: 100%; background: var(--primary); color: white; border: none; padding: 15px; font-size: 16px; font-weight: 700;
            border-radius: 50px; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }
        button.btn-main:hover { background: #34495e; transform: translateY(-2px); }
        button.btn-main:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        #resultPage { display: none; max-width: 1200px; margin: 0 auto; padding-bottom: 50px; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .action-buttons { display: flex; gap: 10px; }

        .btn-back { background: white; color: var(--primary); padding: 8px 20px; border-radius: 20px; border: 1px solid var(--primary); cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-back:hover { background: #f0f0f0; }
        .btn-print { background: #27ae60; color: white; padding: 8px 20px; border-radius: 20px; border: none; cursor: pointer; font-weight: 600; box-shadow: 0 4px 6px rgba(39, 174, 96, 0.2); transition: 0.2s; }
        .btn-print:hover { background: #219150; transform: translateY(-2px); }

        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; justify-content: center; }
        .day-card {
            background: white; border-radius: 16px; overflow: hidden; box-shadow: var(--card-shadow); display: flex; flex-direction: column;
            border-top: 5px solid transparent; opacity: 0; transform: translateY(20px) scale(0.9);
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn { to { opacity: 1; transform: translateY(0) scale(1); } }

        .card-header { padding: 15px; text-align: center; color: white; }
        .day-name { font-size: 1.5rem; font-weight: 800; display: block; letter-spacing: 1px; }
        .day-date { font-size: 0.85rem; opacity: 0.9; font-weight: 400; }
        .card-body { padding: 0; flex: 1; display: flex; flex-direction: column; }
        .section-piket { padding: 15px; flex: 1; }
        .section-title { font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #95a5a6; font-weight: 700; margin-bottom: 10px; display: block; }
        .student-list { list-style: none; padding: 0; margin: 0; }
        .student-item { display: flex; align-items: center; padding: 6px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .student-item:last-child { border-bottom: none; }
        .dot { width: 8px; height: 8px; border-radius: 50%; margin-right: 10px; }
        .dot-m { background: #3498db; } .dot-f { background: #e74c3c; }
        .section-doa { background: #fdfefe; border-top: 2px dashed #ecf0f1; padding: 15px; }
        .doa-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .doa-badge { background: #f1c40f; color: #d35400; font-size: 11px; font-weight: bold; padding: 2px 8px; border-radius: 10px; }

        .appreciation-box {
            margin-top: 40px; background: #fff3e0; border: 1px solid #ffe0b2; padding: 20px; border-radius: 12px; text-align: center;
            animation: fadeIn 1s ease 1s forwards; opacity: 0;
        }
        .appreciation-box h3 { margin: 0 0 10px 0; color: #e65100; font-size: 16px; }
        .appreciation-box p { margin: 0; font-size: 14px; color: #5d4037; }
        @keyframes fadeIn { to { opacity: 1; } }

        #loadingOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 999;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .footer-credit { text-align: center; margin-top: 40px; font-size: 12px; color: #bdc3c7; padding-bottom: 10px; }

        @media (max-width: 600px) {
            #inputPage { padding: 20px; width: 90%; margin: 10px auto; }
            h1.logo-text { font-size: 2.5rem; }
            .input-group { flex-direction: column; }
            .teacher-note { flex-direction: column; }
            .header-bar { justify-content: center; text-align: center; flex-direction: column; }
            .header-bar h2 { width: 100%; margin-bottom: 15px; }
            .action-buttons { width: 100%; gap: 10px; }
            .btn-back, .btn-print { flex: 1; padding: 12px; font-size: 14px; }
            .cal-day { padding: 5px; font-size: 12px; }
            .cal-day-name { font-size: 10px; }
        }

        @media print {
            body { background: white; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            #inputPage, .action-buttons, #loadingOverlay, .footer-credit { display: none !important; }
            #resultPage { display: block !important; margin: 0 auto; width: 100%; max-width: 100%; }
            .header-bar { justify-content: center; }
            .header-bar h2 { text-align: center; width: 100%; }
            .schedule-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; justify-content: center; }
            .day-card { border: 1px solid #ddd; box-shadow: none; break-inside: avoid; page-break-inside: avoid; animation: none !important; opacity: 1 !important; transform: none !important; }
            .card-header { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .logo-container { animation: none !important; }
            h1.logo-text { -webkit-text-fill-color: #333 !important; background: none !important; animation: none !important; }
        }
    </style>
</head>
<body>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <h3 style="color: #2c3e50;">Sedang Mengocok Nama... üé≤</h3>
    </div>

    <div id="inputPage">
        <div class="logo-container">
            <h1 class="logo-text">SiPiko ‚ú®</h1>
            <div class="app-desc">Sistem Piket Kelas Otomatis</div>
        </div>

        <div class="teacher-note">
            <div style="font-size: 30px;">üí°</div>
            <div>
                <h3>Tips untuk Bapak/Ibu Guru:</h3>
                <p>
                    Disarankan untuk mengacak jadwal kembali setiap hari Sabtu. 
                    <strong>Mengapa?</strong> Rotasi mingguan mengajarkan siswa tentang <strong>keadilan</strong> dan <strong>adaptasi</strong>. 
                    Mereka akan belajar bekerja sama dengan teman yang berbeda-beda setiap minggunya, memecahkan "geng" di kelas, 
                    serta melatih tanggung jawab yang merata tanpa ada rasa pilih kasih.
                </p>
            </div>
        </div>
        
        <p class="subtitle">Masukkan nama siswa, sistem akan merapikan otomatis.</p>

        <div class="input-group">
            <div class="input-box male">
                <label>üë¶ Siswa Laki-laki</label>
                <textarea id="inputMale" placeholder="BUDI&#10;AHMAD&#10;JOKO&#10;DENI"></textarea>
            </div>
            <div class="input-box female">
                <label>üëß Siswa Perempuan</label>
                <textarea id="inputFemale" placeholder="SITI&#10;DEWI&#10;RINA&#10;AYU"></textarea>
            </div>
        </div>

        <div class="options-wrapper">
            <div class="checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="allowDuplicate"> 
                    üîÑ Ratakan Jumlah Siswa? (Ada yang rangkap)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="useDate" onchange="toggleDate()"> 
                    üìÖ Tampilkan Tanggal?
                </label>
            </div>
            
            <input type="hidden" id="selectedDateValue">
            
            <div class="calendar-wrapper" id="calendarWrapper">
                <div class="cal-header">
                    <div class="cal-btn" onclick="changeMonth(-1)">‚ùÆ</div>
                    <div id="calMonthYear">Februari 2026</div>
                    <div class="cal-btn" onclick="changeMonth(1)">‚ùØ</div>
                </div>
                <div class="cal-grid" id="calGrid"></div>
            </div>
        </div>

        <button class="btn-main" onclick="startGeneration()">üé≤ ACAK & GENERATE JADWAL</button>

        <div class="footer-credit">Created by <b>The Alus</b> &copy; 2026</div>
    </div>

    <div id="resultPage">
        <div class="header-bar">
            <h2>üìÖ Jadwal Minggu Ini</h2>
            <div class="action-buttons">
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è Simpan PDF</button>
                <button class="btn-back" onclick="resetApp()">üîÑ Ulang</button>
            </div>
        </div>

        <div class="schedule-grid" id="gridResult"></div>

        <div id="appreciationSection" class="appreciation-box" style="display: none;"></div>
        
        <div class="footer-credit">Created by <b>SiPiko Developer</b> &copy; 2024</div>
    </div>

    <script>
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123) { return false; }
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) { return false; }
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) { return false; }
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) { return false; }
        }

        const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22'];
        const days = ["SENIN", "SELASA", "RABU", "KAMIS", "JUMAT", "SABTU"];
        const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];

        let currDate = new Date();
        let currMonth = currDate.getMonth();
        let currYear = currDate.getFullYear();
        let selectedDate = null;

        function toggleDate() {
            const checkbox = document.getElementById('useDate');
            const wrapper = document.getElementById('calendarWrapper');
            if (checkbox.checked) {
                wrapper.style.display = 'block';
                setNextMonday();
                renderCalendar();
            } else {
                wrapper.style.display = 'none';
                selectedDate = null;
            }
        }

        function setNextMonday() {
            const today = new Date();
            const dayOfWeek = today.getDay(); 
            const daysUntilNextMonday = (8 - dayOfWeek) % 7 || 7; 
            const nextMonday = new Date(today);
            nextMonday.setDate(today.getDate() + daysUntilNextMonday);
            selectedDate = nextMonday;
            currMonth = selectedDate.getMonth();
            currYear = selectedDate.getFullYear();
            updateHiddenInput();
        }

        function changeMonth(dir) {
            currMonth += dir;
            if (currMonth < 0) { currMonth = 11; currYear--; }
            if (currMonth > 11) { currMonth = 0; currYear++; }
            renderCalendar();
        }

        function renderCalendar() {
            const grid = document.getElementById('calGrid');
            const monthYearLabel = document.getElementById('calMonthYear');
            grid.innerHTML = '';
            monthYearLabel.innerText = `${monthNames[currMonth]} ${currYear}`;
            const dayHeaders = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
            dayHeaders.forEach(d => grid.innerHTML += `<div class="cal-day-name">${d}</div>`);
            const firstDayOfMonth = new Date(currYear, currMonth, 1).getDay();
            const startDay = firstDayOfMonth === 0 ? 6 : firstDayOfMonth - 1;
            const daysInMonth = new Date(currYear, currMonth + 1, 0).getDate();
            for (let i = 0; i < startDay; i++) { grid.innerHTML += `<div class="cal-day empty"></div>`; }
            for (let i = 1; i <= daysInMonth; i++) {
                const dateObj = new Date(currYear, currMonth, i);
                let isSelected = selectedDate && dateObj.getDate() === selectedDate.getDate() && dateObj.getMonth() === selectedDate.getMonth() && dateObj.getFullYear() === selectedDate.getFullYear();
                const dayDiv = document.createElement('div');
                dayDiv.className = `cal-day ${isSelected ? 'selected' : ''}`;
                dayDiv.innerText = i;
                dayDiv.onclick = () => selectDate(i);
                grid.appendChild(dayDiv);
            }
        }

        function selectDate(day) {
            let clickedDate = new Date(currYear, currMonth, day);
            let dayIndex = clickedDate.getDay();
            let diff = dayIndex === 0 ? 6 : dayIndex - 1;
            clickedDate.setDate(clickedDate.getDate() - diff);
            selectedDate = clickedDate;
            updateHiddenInput();
            renderCalendar();
        }

        function updateHiddenInput() {
            if(!selectedDate) return;
            const yyyy = selectedDate.getFullYear();
            const mm = String(selectedDate.getMonth() + 1).padStart(2, '0');
            const dd = String(selectedDate.getDate()).padStart(2, '0');
            document.getElementById('selectedDateValue').value = `${yyyy}-${mm}-${dd}`;
        }

        function cleanName(name) { return name.replace(/[^a-zA-Z\s]/g, '').replace(/\s+/g, ' ').trim().toUpperCase(); }

        function startGeneration() {
            let rawMale = document.getElementById('inputMale').value.trim();
            let rawFemale = document.getElementById('inputFemale').value.trim();
            if (!rawMale && !rawFemale) { alert("Mohon masukkan nama siswa!"); return; }
            document.getElementById('loadingOverlay').style.display = 'flex';
            setTimeout(() => { document.getElementById('loadingOverlay').style.display = 'none'; processSchedule(); }, 1500);
        }

        function processSchedule() {
            let rawMale = document.getElementById('inputMale').value.split('\n');
            let rawFemale = document.getElementById('inputFemale').value.split('\n');
            let males = rawMale.map(cleanName).filter(n => n.length > 0);
            let females = rawFemale.map(cleanName).filter(n => n.length > 0);
            
            males = [...new Set(males)];
            females = [...new Set(females)];

            document.getElementById('inputMale').value = males.join('\n');
            document.getElementById('inputFemale').value = females.join('\n');

            const allowDuplicate = document.getElementById('allowDuplicate').checked;

            function balanceArray(arr) {
                if (arr.length === 0) return arr;
                let targetSize = Math.ceil(arr.length / 6) * 6;
                let tempArr = [...arr];
                while (tempArr.length < targetSize) { tempArr.push(arr[Math.floor(Math.random() * arr.length)]); }
                return tempArr;
            }

            let finalMales, finalFemales;

            if (allowDuplicate) {
                finalMales = balanceArray(males);
                finalFemales = balanceArray(females);
            } else {
                finalMales = [...males];
                finalFemales = [...females];
            }

            shuffle(finalMales);
            shuffle(finalFemales);

            let schedule = Array.from({length: 6}, () => ({ piket: [], doa: [] }));

            // --- LOGIKA DISTRIBUSI BARU (ESTAFET & JUMAT TERAKHIR) ---
            // Urutan prioritas pengisian: Sen, Sel, Rab, Kam, Sab, Jum.
            // Jumat (Index 4) ditaruh paling belakang agar jika sisa, dia yang paling kosong.
            const priorityOrder = [0, 1, 2, 3, 5, 4]; 
            
            // Pointer global agar gender saling melanjutkan (Estafet)
            // Jika Laki-laki habis di index 2, Perempuan lanjut dari index 3.
            let globalCounter = 0;

            function distribute(list, gender) {
                list.forEach((name) => {
                    let dayIndex;
                    if (allowDuplicate) {
                        // Jika mode rata, pakai urutan biasa 0-5
                        dayIndex = globalCounter % 6;
                    } else {
                        // Jika mode murni, pakai urutan prioritas
                        dayIndex = priorityOrder[globalCounter % 6];
                    }
                    schedule[dayIndex].piket.push({name, gender});
                    globalCounter++;
                });
            }

            distribute(finalMales, 'm');
            distribute(finalFemales, 'f');

            // --- LOGIC DOA ---
            let allStudents = [...males, ...females];
            shuffle(allStudents);
            let doaPointer = 0;
            for(let i=0; i<6; i++) {
                let p1 = allStudents[(doaPointer++) % allStudents.length];
                let p2 = allStudents[(doaPointer++) % allStudents.length];
                schedule[i].doa.push(p1, p2);
            }

            const grid = document.getElementById('gridResult');
            grid.innerHTML = '';
            const useDate = document.getElementById('useDate').checked;
            const startDateVal = document.getElementById('selectedDateValue').value;
            let startDate = startDateVal ? new Date(startDateVal) : null;
            let dutyCounts = {};

            schedule.forEach((dayData, i) => {
                let dateDisplay = "";
                if (useDate && startDate) {
                    let d = new Date(startDate); d.setDate(startDate.getDate() + i);
                    dateDisplay = d.toLocaleDateString('id-ID', {day: 'numeric', month: 'long', year: 'numeric'});
                }
                let piketHtml = dayData.piket.map(s => {
                    dutyCounts[s.name] = (dutyCounts[s.name] || 0) + 1;
                    return `<li class="student-item"><span class="dot ${s.gender === 'm' ? 'dot-m' : 'dot-f'}"></span>${s.name}</li>`;
                }).join('');
                let delay = i * 0.15;
                grid.innerHTML += `
                    <div class="day-card" style="border-top-color: ${colors[i]}; animation-delay: ${delay}s">
                        <div class="card-header" style="background: ${colors[i]}"><span class="day-name">${days[i]}</span><span class="day-date">${dateDisplay}</span></div>
                        <div class="card-body">
                            <div class="section-piket"><span class="section-title">üßπ Petugas Kebersihan</span><ul class="student-list">${piketHtml}</ul></div>
                            <div class="section-doa"><span class="section-title">ü§≤ Pemimpin Doa</span>
                                <div class="doa-row"><span class="doa-badge">Pagi</span><span>${dayData.doa[0]}</span></div>
                                <div class="doa-row"><span class="doa-badge">Pulang</span><span>${dayData.doa[1]}</span></div>
                            </div>
                        </div>
                    </div>`;
            });

            const msgBox = document.getElementById('appreciationSection');
            if (allowDuplicate) {
                const duplicates = Object.keys(dutyCounts).filter(name => dutyCounts[name] > 1);
                if (duplicates.length > 0) {
                    msgBox.style.display = 'block';
                    msgBox.innerHTML = `<h3>üåü Semangat Ekstra Minggu Ini! üåü</h3><p>Terima kasih khusus kepada: <strong>${duplicates.join(', ')}</strong>.</p><p>Karena "Mode Ratakan Jumlah" aktif, kalian mendapatkan tugas tambahan agar tim piket seimbang. Semangat! üí™</p>`;
                } else { msgBox.style.display = 'none'; }
            } else {
                msgBox.style.display = 'none';
            }

            document.getElementById('inputPage').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';
            window.scrollTo(0,0);
        }

        function resetApp() { document.getElementById('resultPage').style.display = 'none'; document.getElementById('inputPage').style.display = 'block'; }
        function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
    </script>
</body>
</html>